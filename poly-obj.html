<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">


<!--
`poly-obj`
Objects creator

@demo demo/index.html
-->

<dom-module id='poly-obj'>
  <template>
    <style is='custom-style' include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }
      paper-button.custom {
        --paper-button-ink-color: var(--paper-pink-a200);
        /* These could also be individually defined for each of the
        specific css classes, but we'll just do it once as an example */
        --paper-button-flat-keyboard-focus: {
          background-color: var(--paper-pink-a200);
          color: white !important;
        };
        --paper-button-raised-keyboard-focus: {
          background-color: var(--paper-pink-a200) !important;
          color: white !important;
        };
      }
      paper-button.amber {
        background-color: var(--paper-amber-800);
        color: white;
      }
      paper-button.green {
        background-color: var(--paper-green-500);
        color: white;
      }
      form {
        margin-bottom: 28px;
      }
      #form-container {
        margin-bottom: 18px;
      }
      #list-container {
        margin-top: 52px;
      }
      #list-item {
        margin: 8px 0px;
        padding: 10px;
        background: var(--paper-indigo-600);
        color: #FFF;
        border-radius: 50px;
      }
      #item-name {
        padding: 8px;
        width: 80%;
      }
      #item-options {
        float: right;
        padding:6px;
      }
      .flex-center-justified {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }
      .flex-end-justified {
        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
      }
      .flex-horizontal {
        @apply(--layout-horizontal);
      }
      .flex-vertical {
        @apply(--layout-vertical);
      }
      .flexchild-vertical {
        @apply(--layout-flex);
      }
    </style>

    <form is='iron-form' method='get' action='/' class='flex-vertical'>
      <div class='flexchild-vertical' id='form-container'>
        <paper-input
          label='Collection Name'
          name='objectName'
          char-counter
          maxlength='20'
          required>
        </paper-input>
        <paper-input
          label='Main Field'
          name='mainFieldName'
          char-counter
          maxlength='16'
          required>
        </paper-input>
        <paper-button
          toggles
          raised
          on-tap='_addField'
          class='custom green'>Add Field
        </paper-button>
        <template is="dom-repeat" items="[[extraFields]]">
          <paper-input
            label='Field {{index}}'
            name='objectName{{index}}'
            char-counter
            maxlength='16'>
          </paper-input>
        </template>
      </div>
      <div class='flex-center-justified' id='form-buttons'>
        <paper-button
          toggles
          raised
          on-tap='_create'
          class='custom green'>Create
        </paper-button>
        <paper-button
          toggles
          raised
          on-tap='_clear'
          class='custom amber'>Clear
        </paper-button>
      </div>
    </form>
    <iron-ajax
      auto
      url='objects.json'
      params=''
      handle-as='json'
      on-response='objectsResponse'
      debounce-duration='300'
      last-response='{{objects}}'
      id='ajaxGet'>
    </iron-ajax>
    <div id='list-container'>
      <template is="dom-repeat" items="[[objects]]">
        <div id='list-item'>
          <div id='item-options'>
            <iron-icon icon="icons:more-vert"></iron-icon>
          </div>
          <div id='item-name'>
            {{item.name}}
          </div>
        </div>
      </template>
    </div>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'poly-obj',

      listeners: {
        'iron-form-submit': 'formSubmited'
      },

      properties: {
        objects: {
          type: Array,
          value: () => {
            return [];
          }
        },
        extraFields: {
          type: Array,
          value: () => {
            return [];
          }
        }
      },

      _create() {
        let form = this.$$('form');
        //let objectName = form.name.value;
        form.submit();
        //this.$.ajaxGet.generateRequest();
      },

      _clear() {
        let form = this.$$('form');
        form.reset();
        //form.querySelector('.output').innerHTML = '';
      },

      _addField() {
        let newField = {};
        this.push('extraFields', newField);
      },

      objectsResponse(request) {
        let response = request.detail.response;
        //this.objects = response;
      },

      formSubmited(event) {
        let newObject = {};
        newObject.name = event.detail.objectName;
        newObject.extraFields = [{
          'name': event.detail.mainFieldName,
          'type': 'String'
        }];
        /*this.extraFields.forEach((value) => {
          newObject.push('extraFields', value)
        });*/
        this.push('objects', newObject);
        this.extraFields = [];
        this.$$('form').reset();
      }

    });
  }());
  </script>
</dom-module>
